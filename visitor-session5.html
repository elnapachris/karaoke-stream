
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pedir una CanciÃ³n</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    body { background-color: #111; color: #fff; font-family: sans-serif; text-align: center; padding: 20px; }
    input, button { padding: 10px; margin: 5px; border-radius: 8px; width: 90%; max-width: 400px; }
    button:disabled { background-color: #444; }
    .info { color: orange; margin-top: 10px; }
    .success { color: violet; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>ðŸŽ¤ Pedir una CanciÃ³n</h2>
  <input id="nombre" placeholder="Tu nombre"><br>
  <input id="cancion" placeholder="CanciÃ³n"><br>
  <input id="artista" placeholder="Artista"><br>
  <button id="btnAgregar" onclick="agregarCancion()" disabled>Agregar CanciÃ³n</button>
  <div id="mensaje" class="info">ðŸŽ§ Contacta al DJ para que habilite tu acceso</div>

  <script>
    const firebaseConfig = {
      databaseURL: "https://karaokedatabase-c6a7d-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const sessionId = sessionStorage.getItem("sessionId") || (Date.now().toString(36) + Math.random().toString(36).substr(2));
    sessionStorage.setItem("sessionId", sessionId);

    const ref = db.ref("visitantes/" + sessionId);
    ref.once("value").then(snap => {
      if (!snap.exists()) ref.set({ nombre: "", habilitado: false });
    });

    ref.on("value", snap => {
      const data = snap.val();
      if (data) {
        document.getElementById("nombre").value = data.nombre || "";
        document.getElementById("btnAgregar").disabled = !data.habilitado;
        document.getElementById("mensaje").innerHTML = data.habilitado ? "âœ… Puedes agregar tu canciÃ³n" : "ðŸŽ§ Contacta al DJ para que habilite tu acceso";
      }
    });

    function agregarCancion() {
      const nombre = document.getElementById("nombre").value.trim();
      const cancion = document.getElementById("cancion").value.trim();
      const artista = document.getElementById("artista").value.trim();
      if (!nombre || !cancion || !artista) return alert("Completa todos los campos");
      db.ref("songs").push({ nombre, cancion, artista, timestamp: Date.now() });
      ref.update({ nombre, habilitado: false });
      document.getElementById("cancion").value = "";
      document.getElementById("artista").value = "";
      document.getElementById("btnAgregar").disabled = true;
      document.getElementById("mensaje").innerHTML = "ðŸŽµ CanciÃ³n agregada. Â¡Gracias!";
      document.getElementById("mensaje").className = "success";
    }
  </script>
</body>
</html>
