
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Visitor Session 13</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { background: #111; color: white; font-family: sans-serif; text-align: center; padding: 2em; }
        input, button { margin: 0.5em; padding: 0.5em; width: 80%; }
        #status { color: orange; margin-top: 1em; }
    </style>
</head>
<body>
    <h2>ðŸŽ¤ Pedir una CanciÃ³n</h2>
    <input id="nombre" placeholder="Tu nombre" />
    <input id="cancion" placeholder="Nombre de la canciÃ³n" />
    <input id="artista" placeholder="Artista" />
    <button onclick="agregarCancion()">Agregar CanciÃ³n</button>
    <div id="status">ðŸŽ§ Contacta al DJ para que habilite tu acceso</div>

    <script>
        const firebaseConfig = {
            databaseURL: "https://karaokedatabase-c6a7d-default-rtdb.firebaseio.com"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const sessionID = Math.floor(Math.random() * 10000);
        db.ref("visitantes/" + sessionID).set({ nombre: "", habilitado: false });

        document.getElementById("nombre").addEventListener("change", (e) => {
            const nombre = e.target.value.trim();
            if (nombre) {
                db.ref("visitantes/" + sessionID + "/nombre").set(nombre);
            }
        });

        db.ref("visitantes/" + sessionID + "/habilitado").on("value", snapshot => {
            const estado = snapshot.val();
            document.getElementById("status").style.display = estado ? "none" : "block";
            document.querySelector("button").disabled = !estado;
        });

        function agregarCancion() {
            const nombre = document.getElementById("nombre").value.trim() || "Sin nombre";
            const cancion = document.getElementById("cancion").value.trim() || "Sin tÃ­tulo";
            const artista = document.getElementById("artista").value.trim() || "Desconocido";

            if (!nombre || !cancion || !artista) return;

            db.ref("songs").push({
                nombre: nombre,
                cancion: cancion,
                artista: artista,
                mesa: "Mesa " + sessionID,
                estado: "Online",
                saludo: "karaoke"
            });

            document.getElementById("cancion").value = "";
            document.getElementById("artista").value = "";
        }
    </script>
</body>
</html>
