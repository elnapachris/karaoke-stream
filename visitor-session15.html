<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pedir Canción</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body class="bg-dark text-white">
  <div class="container mt-4">
    <h1 class="text-center mb-4">🎤 Pedir una Canción</h1>
    <input type="text" id="nombreInput" class="form-control mb-2" placeholder="Tu nombre" oninput="saveNombre()">
    <input type="text" id="artistaInput" class="form-control mb-2" placeholder="Artista">
    <input type="text" id="cancionInput" class="form-control mb-3" placeholder="Canción">
    <button id="addBtn" class="btn btn-primary btn-block mb-2" onclick="addSong()" disabled>Agregar Canción</button>
    <p class="text-warning text-center"><span id="statusMsg">🎧 Contacta al DJ para que habilite tu acceso</span></p>
  </div>
<script>
const firebaseConfig = {
  databaseURL: "https://karaokedatabase-c6a7d-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const sessionId = sessionStorage.getItem("sessionId") || Math.floor(Math.random() * 1000000).toString();
sessionStorage.setItem("sessionId", sessionId);
let visitorRef = db.ref("visitantes/" + sessionId);

function saveNombre() {
  const nombre = document.getElementById("nombreInput").value;
  visitorRef.set({ nombre: nombre, habilitado: false });
}

function checkAccess() {
  visitorRef.on("value", (snap) => {
    const data = snap.val();
    const addBtn = document.getElementById("addBtn");
    const msg = document.getElementById("statusMsg");
    if (data && data.habilitado) {
      addBtn.disabled = false;
      msg.textContent = "🎶 Ya puedes pedir tu canción";
    } else {
      addBtn.disabled = true;
      msg.textContent = "🎧 Contacta al DJ para que habilite tu acceso";
    }
  });
}

function addSong() {
  const nombre = document.getElementById("nombreInput").value.trim();
  const artista = document.getElementById("artistaInput").value.trim();
  const cancion = document.getElementById("cancionInput").value.trim();
  if (!nombre || !artista || !cancion) return;

  db.ref("songs").push({
    numero: "Mesa " + sessionId,
    nombre: nombre,
    artista: artista,
    cancion: cancion,
    tipo: "karaoke"
  });

  document.getElementById("artistaInput").value = "";
  document.getElementById("cancionInput").value = "";
  visitorRef.update({ habilitado: false });
  document.getElementById("addBtn").disabled = true;
}

checkAccess();
</script>
</body>
</html>
