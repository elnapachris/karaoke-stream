<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body class="bg-dark text-white">
    <div class="container mt-4">
        <h1 class="text-center mb-4">🎤 Panel Admin - Lista de Canciones</h1>
        <table class="table table-bordered table-striped table-sm text-white bg-secondary">
            <thead class="bg-danger text-white">
                <tr>
                    <th>Posición</th>
                    <th>Nro de Mesa</th>
                    <th>Nombre</th>
                    <th>Artista</th>
                    <th>Canción</th>
                    <th>Tipo</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="songList"></tbody>
        </table>
        <button class="btn btn-danger mt-2" onclick="clearSongs()">Limpiar Cola de Canciones</button>

        <hr class="my-4">

        <h2 class="text-center">🛠️ Panel Admin - Visitantes conectados</h2>
        <button class="btn btn-warning mb-2" onclick="clearVisitors()">🧹 Limpiar Visitantes</button>
        <table class="table table-dark table-bordered">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="visitorList"></tbody>
        </table>
    </div>
<script>
const firebaseConfig = {
  databaseURL: "https://karaokedatabase-c6a7d-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function renderSongList() {
  const songList = document.getElementById("songList");
  db.ref("songs").on("value", (snapshot) => {
    songList.innerHTML = "";
    let pos = 1;
    snapshot.forEach(child => {
      const data = child.val();
      if (!data.nombre || !data.artista || !data.cancion) return;
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${pos++}</td>
        <td>${data.numero || ""}</td>
        <td>${data.nombre}</td>
        <td>${data.artista}</td>
        <td>${data.cancion}</td>
        <td>${data.tipo || "karaoke"}</td>
        <td><button class="btn btn-danger btn-sm" onclick="removeSong('${child.key}')">Eliminar</button></td>
      `;
      songList.appendChild(row);
    });
  });
}

function removeSong(key) {
  db.ref("songs/" + key).remove();
}

function clearSongs() {
  db.ref("songs").remove();
}

function renderVisitorList() {
  const visitorList = document.getElementById("visitorList");
  db.ref("visitantes").on("value", (snapshot) => {
    visitorList.innerHTML = "";
    snapshot.forEach(child => {
      const data = child.val();
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${data.nombre || "Sin nombre"}</td>
        <td>${data.habilitado ? "Habilitado" : "Deshabilitado"}</td>
        <td><button class="btn btn-${data.habilitado ? "danger" : "success"} btn-sm"
          onclick="toggleAccess('${child.key}', ${data.habilitado})">
          ${data.habilitado ? "Deshabilitar" : "Habilitar"}</button></td>
      `;
      visitorList.appendChild(row);
    });
  });
}

function toggleAccess(sessionId, currentState) {
  db.ref("visitantes/" + sessionId).update({ habilitado: !currentState });
}

function clearVisitors() {
  db.ref("visitantes").remove();
}

renderSongList();
renderVisitorList();
</script>
</body>
</html>
